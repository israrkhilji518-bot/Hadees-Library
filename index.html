<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Islamic Library | Premium Hadees App</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Amiri:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

    <style>
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(-20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideInLeft { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        @keyframes slideInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes shimmer { 0% { background-position: -1000px 0; } 100% { background-position: 1000px 0; } }
        
        :root { --primary: #123e37; --accent: #c5a059; --bg: #f0f4f3; --white: #ffffff; --text: #2d3436; }
        body { font-family: 'Inter', sans-serif; margin: 0; display: flex; height: 100vh; background: var(--bg); overflow: hidden; color: var(--text); }

        .sidebar { width: 340px; min-width: 340px; background: var(--primary); color: white; display: flex; flex-direction: column; box-shadow: 4px 0 20px rgba(0,0,0,0.2); z-index: 100; transition: 0.3s; animation: slideInLeft 0.4s ease-out; }
        .side-search-box { padding: 15px; background: rgba(0,0,0,0.2); display: flex; flex-direction: column; gap: 8px; animation: fadeIn 0.5s ease-out 0.1s both; }
        .side-input { width: 100%; padding: 12px; border-radius: 8px; border: none; background: rgba(255,255,255,0.1); color: white; outline: none; box-sizing: border-box; font-family: 'Inter', sans-serif; font-size: 0.95rem; }
        .menu-scroll { flex-grow: 1; overflow-y: auto; padding: 15px; }
        .sidebar-bottom { padding: 20px; background: rgba(0,0,0,0.1); border-top: 1px solid rgba(255,255,255,0.1); }
        .book-head { background: rgba(255,255,255,0.08); padding: 15px; border-radius: 12px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; transition: 0.3s ease; font-family: 'Inter', sans-serif; animation: fadeIn 0.4s ease-out; }
        .book-head:hover { background: rgba(255,255,255,0.15); transform: translateX(5px); }
        .chap-item { display: flex; justify-content: space-between; align-items: center; background: rgba(255,255,255,0.9); margin-bottom: 5px; border-radius: 8px; padding-right: 10px; animation: slideInRight 0.3s ease-out; transition: 0.2s; }
        .chap-item:hover { transform: translateX(-3px); }
        .chap-btn { flex: 1; padding: 12px; font-size: 0.95rem; cursor: pointer; color: #000000; font-weight: 500; font-family: 'Inter', sans-serif; }

        .hadees-title:hover, .book-item:hover { background: #f8f9fa; transform: translateY(-3px); transition: 0.3s ease; box-shadow: 0 8px 16px rgba(0,0,0,0.1) !important; }

        .main-container { flex-grow: 1; display: flex; flex-direction: column; overflow-y: auto; position: relative; -webkit-overflow-scrolling: touch; }
        .top-bar { padding: 15px 30px; background: white; display: flex; gap: 15px; box-shadow: 0 2px 15px rgba(0,0,0,0.05); align-items: center; position: sticky; top: 0; z-index: 10; animation: slideInDown 0.4s ease-out; }
        #home-view { display: flex; flex-direction: column; overflow-y: auto; -webkit-overflow-scrolling: touch; }
        @keyframes slideInDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .main-search { flex: 1; padding: 12px 25px; border-radius: 30px; border: 1.5px solid #eee; outline: none; background: #f9f9f9; font-family: 'Inter', sans-serif; font-size: 0.95rem; }

        .hero-section { background: linear-gradient(135deg, var(--primary), #1a5d52); padding: 60px 20px; color: white; text-align: center; border-radius: 0 0 40px 40px; margin-bottom: 40px; animation: slideInUp 0.6s ease-out; }
        .hotd-card { max-width: 800px; margin: -50px auto 30px; background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 5px solid var(--accent); animation: slideInUp 0.6s ease-out; }
        
        .quick-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 20px; max-width: 800px; margin: 0 auto 40px; padding: 0 20px; }
        .quick-card { background: white; padding: 20px; border-radius: 15px; text-align: center; cursor: pointer; transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); border: 1px solid #eee; font-family: 'Inter', sans-serif; animation: scaleIn 0.5s ease-out; }
        .quick-card:hover { transform: translateY(-8px) scale(1.05); box-shadow: 0 12px 24px rgba(0,0,0,0.15); border-color: var(--accent); }
        .quick-card i { font-size: 24px; color: var(--accent); margin-bottom: 10px; }
        .quick-card b { font-size: 1rem; display: block; margin: 8px 0 5px 0; }
        .quick-card div:last-child { font-size: 1.1rem; font-weight: 600; }

        .content-area { padding: 30px; max-width: 900px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        .hadees-card { background: white; padding: 30px; border-radius: 20px; margin-bottom: 25px; box-shadow: 0 4px 20px rgba(0,0,0,0.04); position: relative; animation: fadeIn 0.4s ease-out; transition: 0.3s ease; }
        .hadees-card:hover { box-shadow: 0 8px 30px rgba(0,0,0,0.08); transform: translateY(-2px); }
        .arabic { font-family: 'Amiri', serif; font-size: 1.8rem; text-align: right; direction: rtl; line-height: 2; color: #1e272e; margin-bottom: 20px; }
        .translation { font-family: 'Inter', sans-serif; font-size: 1rem; line-height: 1.6; color: #485460; }
        .card-actions { display: flex; gap: 15px; margin-top: 20px; border-top: 1px solid #f1f1f1; padding-top: 15px; }
        .action-btn { cursor: pointer; color: #999; transition: 0.3s ease; font-size: 0.95rem; font-family: 'Inter', sans-serif; font-weight: 500; }
        .action-btn:hover { color: var(--accent); transform: scale(1.1); display: inline-block; }

        .menu-toggle { display: none; font-size: 22px; cursor: pointer; }
        
        /* Tablet (iPad) - 768px and below */
        @media (max-width: 768px) {
            body { display: flex; flex-direction: column; height: 100vh; }
            .sidebar { position: fixed; left: -100%; height: 100%; width: 340px; transition: 0.4s ease-in-out; top: 0; }
            .sidebar.active { left: 0; box-shadow: 4px 0 20px rgba(0,0,0,0.3); }
            .main-container { flex-grow: 1; }
            .menu-toggle { display: block; padding: 10px; }
            .top-bar { padding: 12px 20px; }
            .main-search { padding: 10px 20px; font-size: 0.95rem; }
            .hero-section { padding: 40px 20px; }
            .hotd-card { width: 90%; margin: -40px auto 20px; padding: 25px; }
            .quick-grid { grid-template-columns: repeat(3, 1fr); gap: 15px; padding: 0 15px; }
            .quick-card { padding: 18px 10px; }
            .quick-card i { font-size: 22px; }
            .content-area { padding: 20px 15px; }
            .hadees-card { padding: 25px 20px; margin-bottom: 20px; }
            .arabic { font-size: 1.5rem; line-height: 1.9; }
            .translation { font-size: 0.95rem; }
            .card-actions { gap: 12px; }
            .action-btn { font-size: 0.9rem; padding: 8px 12px; }
            .side-search-box { padding: 12px; gap: 8px; }
            .side-input { padding: 11px; font-size: 0.92rem; }
            .book-head { padding: 12px; font-size: 0.95rem; }
            .chap-btn { padding: 10px; font-size: 0.92rem; }
            .modal { width: 90%; max-width: 500px; padding: 25px; }
            .modal h3 { font-size: 1.2rem; }
        }

        /* Small Tablet - 600px and below */
        @media (max-width: 600px) {
            .sidebar { width: 85vw; }
            .content-area { padding: 15px 12px; }
            .hadees-card { padding: 20px 15px; }
            .arabic { font-size: 1.3rem; }
            .quick-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; }
            .quick-card { padding: 15px; }
            .hotd-card { padding: 20px; }
        }

        /* Mobile Phone - 480px and below */
        @media (max-width: 480px) {
            * { -webkit-tap-highlight-color: transparent; }
            body { height: 100vh; flex-direction: column; }
            .sidebar { width: 100%; left: -100%; height: 100vh; display: flex; flex-direction: column; }
            .sidebar.active { left: 0; width: 100%; }
            .sidebar-bottom { padding: 15px; flex-shrink: 0; }
            .menu-scroll { flex: 1; overflow-y: auto; }
            .main-container { flex: 1; overflow-y: auto; height: calc(100vh - 60px); }
            .top-bar { padding: 10px 12px; gap: 8px; position: sticky; top: 0; display: flex; align-items: center; }
            .main-search { padding: 9px 15px; font-size: 0.9rem; flex: 1; min-width: 0; }
            .top-bar button { padding: 10px 12px; font-size: 14px; }
            .hero-section { padding: 25px 15px; margin-bottom: 15px; }
            .hero-section h1 { font-size: 1.6rem; margin-bottom: 8px; }
            .hero-section p { font-size: 0.9rem; }
            .hotd-card { width: 95%; padding: 18px; margin: -35px auto 15px; border-radius: 15px; }
            .hotd-card > div:first-child { font-size: 0.85rem; }
            .quick-grid { grid-template-columns: repeat(3, 1fr); gap: 10px; padding: 0 10px; margin: 0 auto 20px; }
            .quick-card { padding: 12px 8px; border-radius: 12px; }
            .quick-card i { font-size: 18px; margin-bottom: 6px; }
            .quick-card b { font-size: 0.85rem; margin: 5px 0 4px 0; }
            .quick-card div:last-child { font-size: 1rem; }
            .content-area { padding: 12px 10px; max-width: 100%; }
            .hadees-card { padding: 18px 15px; margin-bottom: 12px; border-radius: 15px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
            .hadees-card > div:first-child { font-size: 0.8rem; }
            .arabic { font-size: 1.15rem; line-height: 1.8; margin-bottom: 15px; }
            .translation { font-size: 0.88rem; line-height: 1.5; }
            .card-actions { flex-direction: column; gap: 8px; margin-top: 15px; padding-top: 12px; }
            .action-btn { font-size: 0.85rem; min-height: 44px; display: flex; align-items: center; justify-content: center; padding: 10px; }
            .modal { width: 95%; padding: 18px; border-radius: 15px; max-width: calc(100vw - 20px); }
            .modal h3 { font-size: 1.05rem; margin-bottom: 15px; }
            .modal input, .modal textarea { padding: 10px 12px !important; font-size: 0.9rem !important; margin-bottom: 12px !important; }
            .modal textarea { rows: 3; }
            .side-search-box { gap: 8px; padding: 10px; }
            .side-input { padding: 9px 12px; font-size: 0.88rem; min-height: 44px; }
            .book-wrap { margin-bottom: 5px; }
            .book-head { padding: 12px; font-size: 0.92rem; border-radius: 10px; }
            .chap-item { margin-bottom: 4px; border-radius: 8px; }
            .chap-btn { padding: 10px; font-size: 0.9rem; }
            .book-item { min-height: 44px; }
            .hadees-title { min-height: 44px; }
        }

        /* Extra Small Mobile - 360px and below */
        @media (max-width: 360px) {
            .hero-section h1 { font-size: 1.4rem; }
            .quick-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
            .quick-card { padding: 10px 6px; }
            .quick-card i { font-size: 16px; }
            .quick-card b { font-size: 0.8rem; }
            .arabic { font-size: 1rem; line-height: 1.7; }
            .translation { font-size: 0.85rem; }
            .hadees-card { padding: 15px 12px; }
            .main-search { font-size: 0.85rem; }
            .side-input { font-size: 0.85rem; }
        }

        .admin-btn { background: var(--accent); color: white; border: none; padding: 12px 16px; border-radius: 10px; cursor: pointer; font-weight: 600; width: 100%; margin-top: 10px; font-family: 'Inter', sans-serif; font-size: 0.95rem; transition: 0.3s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .admin-btn:hover { opacity: 0.9; transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 16px rgba(197, 160, 89, 0.3); }
        .admin-btn:active { transform: translateY(-1px) scale(0.98); }
        .modal-overlay { display: none; position: fixed; inset: 0; background:rgba(0,0,0,0.7); z-index: 2000; animation: fadeIn 0.3s ease-out; }
        .modal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 500px; background: white; border-radius: 20px; padding: 30px; z-index: 2001; animation: scaleIn 0.3s ease-out; }
        .modal h3 { font-family: 'Inter', sans-serif; font-size: 1.3rem; margin-bottom: 20px; animation: slideInUp 0.4s ease-out; }
    </style>
</head>
<body onload="initApp()">

<div class="modal-overlay" id="overlay" onclick="closeM()"></div>
<div class="modal" id="uploadModal" style="display:none;">
    <h3>Add New Hadees</h3>
    <input type="number" id="hnum" style="width:100%; padding:12px; margin-bottom:10px; border:1px solid #ddd; border-radius:8px; font-family:'Inter', sans-serif; font-size:0.95rem;" placeholder="Hadees No.">
    <textarea id="harb" style="width:100%; padding:12px; margin-bottom:10px; font-family:Amiri; border:1px solid #ddd; border-radius:8px; font-size:1rem;" rows="4" placeholder="Arabic Text..." dir="rtl"></textarea>
    <textarea id="htrans" style="width:100%; padding:12px; margin-bottom:10px; border:1px solid #ddd; border-radius:8px; font-family:'Inter', sans-serif; font-size:0.95rem;" rows="4" placeholder="Translation Text..."></textarea>
    <button onclick="finalSubmit()" class="admin-btn">PUBLISH HADEES</button>
</div>

<div class="modal-overlay" id="editOverlay" onclick="closeEdit()" style="display:none;"></div>
<div class="modal" id="editModal" style="display:none;">
    <h3>Edit Hadees</h3>
    <input type="hidden" id="editId">
    <input type="number" id="editNum" style="width:100%; padding:12px; margin-bottom:10px; border:1px solid #ddd; border-radius:8px; font-family:'Inter', sans-serif; font-size:0.95rem;" placeholder="Hadees No.">
    <textarea id="editArb" style="width:100%; padding:12px; margin-bottom:10px; font-family:Amiri; border:1px solid #ddd; border-radius:8px; font-size:1rem;" rows="4" dir="rtl" placeholder="Arabic Text..."></textarea>
    <textarea id="editTrans" style="width:100%; padding:12px; margin-bottom:10px; border:1px solid #ddd; border-radius:8px; font-family:'Inter', sans-serif; font-size:0.95rem;" rows="4" placeholder="Translation Text..."></textarea>
    <button onclick="saveEdit()" class="admin-btn" style="background:#4a90e2; margin-right:10px;">SAVE CHANGES</button>
    <button onclick="closeEdit()" class="admin-btn" style="background:#999;">CANCEL</button>
</div>

<div id="side-overlay" onclick="toggleMenu()" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:99;"></div>

<aside class="sidebar" id="sidebar">
    <div style="padding: 25px; text-align: center;">
        <h1 style="color:var(--accent); margin:0; font-family:Amiri; font-size: 2.5rem; cursor:pointer;" onclick="location.reload()">ÿßŸéŸÑŸíÿ≠ŸéÿØŸêŸäŸíÿ´Ÿè</h1>
        <small style="opacity: 0.7; font-family:'Inter', sans-serif; font-size: 0.85rem;">Digital Islamic Library</small>
    </div>
    <div class="side-search-box">
        <input type="text" id="bS" onkeyup="filterSidebar()" class="side-input" placeholder="üîç Search Books...">
        <input type="text" id="cS" onkeyup="filterSidebar()" class="side-input" placeholder="üîç Search Chapters...">
    </div>
    <div class="menu-scroll" id="menu"></div>
    <div class="sidebar-bottom">
        <div id="admin-panel" style="display:none;">
            <button class="admin-btn" style="background:rgba(255,255,255,0.2);" onclick="addBookPrompt()">+ New Book</button>
            <div id="context-msg"></div>
        </div>
        <button onclick="login()" id="loginBtn" class="admin-btn" style="background:transparent; border: 1px solid rgba(255,255,255,0.3); color: white;">Admin Access</button>
    </div>
</aside>

<main class="main-container">
    <div class="top-bar">
        <i class="fa-solid fa-bars menu-toggle" onclick="toggleMenu()"></i>
        <input type="text" id="gT" onkeyup="globalSearch()" class="main-search" placeholder="Search Hadees content or number...">
        <button onclick="globalSearch()" style="background: var(--accent); color: white; border: none; padding: 12px 20px; border-radius: 8px; cursor: pointer; font-size: 16px; min-width: 44px; min-height: 44px; display: flex; align-items: center; justify-content: center; transition: 0.3s;"><i class="fa-solid fa-magnifying-glass"></i></button>
    </div>

    <div id="home-view">
        <div class="hero-section">
            <h1 style="font-family:Amiri; font-size: 2.5rem; margin-bottom: 10px;">ÿ®Ÿêÿ≥ŸíŸÖŸê ÿßŸÑŸÑŸáŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸíŸÖŸ∞ŸÜŸê ÿßŸÑÿ±ŸéŸëÿ≠ŸêŸäŸíŸÖŸê</h1>
            <p style="opacity: 0.9; font-family:'Inter', sans-serif; font-size: 1rem; font-weight: 400;">Welcome to the most advanced digital Hadees repository.</p>
        </div>

        <div class="hotd-card" id="hotd-section">
            <div style="color: var(--accent); font-weight: 600; margin-bottom: 15px; font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; font-family:'Inter', sans-serif;">
                <i class="fa-solid fa-star"></i> Hadees of the Moment
            </div>
            <div id="hotd-content">
                <p style="color: #666; font-family:'Inter', sans-serif; font-size: 0.95rem;">Loading daily inspiration...</p>
            </div>
        </div>

        <div class="quick-grid">
            <div class="quick-card" onclick="showAllBooks()">
                <i class="fa-solid fa-book-open"></i>
                <div><b>Books</b></div>
                <div id="st-b" style="color:var(--accent)">0</div>
            </div>
            <div class="quick-card" onclick="document.getElementById('gT').focus();">
                <i class="fa-solid fa-magnifying-glass"></i>
                <div><b>Search</b></div>
                <div id="st-h" style="color:var(--accent)">0</div>
            </div>
            <div class="quick-card" id="saved-card" onclick="showFavorites()">
                <i class="fa-solid fa-heart"></i>
                <div><b>Saved</b></div>
                <div id="st-saved" style="color:var(--accent)">0</div>
            </div>
            <div class="quick-card" id="admin-card" style="display:none;" onclick="document.getElementById('home-admin-section').scrollIntoView({behavior: 'smooth'});">
                <i class="fa-solid fa-cog"></i>
                <div><b>Admin</b></div>
                <div style="color:var(--accent)">‚úì</div>
            </div>
        </div>

        <div id="home-admin-section" style="display:none; padding: 0 20px 40px; animation: slideInUp 0.6s ease-out;">
            <div style="background: rgba(197, 160, 89, 0.1); border-left: 4px solid var(--accent); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                <h3 style="color: var(--accent); margin: 0 0 15px 0; font-family: 'Inter', sans-serif;">Admin Control Panel</h3>
                <button class="admin-btn" style="background:var(--accent); margin-top: 0;" onclick="addBookPrompt()">
                    <i class="fa-solid fa-plus" style="margin-right: 8px;"></i> Add New Hadees
                </button>
                <div id="home-context-msg"></div>
            </div>
        </div>
    </div>

    <div class="content-area" id="display"></div>
</main>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDkbnYW4pHJXwsFyWAtOR-R5I1hK5A4Gww",
        authDomain: "hadees-library-ea6a6.firebaseapp.com",
        databaseURL: "https://hadees-library-ea6a6-default-rtdb.firebaseio.com",
        projectId: "hadees-library-ea6a6",
        storageBucket: "hadees-library-ea6a6.firebasestorage.app",
        messagingSenderId: "741971433551",
        appId: "1:741971433551:web:68025b3aae4a4a265df23a"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let isAdmin = false, sB = "", sC = "";
    let currentBookData = null;

    function initFavorites() {
        let favorites = JSON.parse(localStorage.getItem('hadees_favorites') || '[]');
        updateSavedCount(favorites.length);
    }

    function toggleFavorite(id) {
        let favorites = JSON.parse(localStorage.getItem('hadees_favorites') || '[]');
        if (favorites.includes(id)) {
            favorites = favorites.filter(fid => fid !== id);
        } else {
            favorites.push(id);
        }
        localStorage.setItem('hadees_favorites', JSON.stringify(favorites));
        updateSavedCount(favorites.length);
        if (sC) renderHadeesList(sC, sB);
        else if (document.getElementById('display').innerHTML.includes('Your Saved Hadees')) showFavorites();
        else globalSearch();
    }

    function updateSavedCount(count) { document.getElementById('st-saved').innerText = count; }
    function isFavorite(id) { return (JSON.parse(localStorage.getItem('hadees_favorites') || '[]')).includes(id); }
    function getFavoriteIcon(id) {
        const isFav = isFavorite(id);
        return `<i class="fa-${isFav ? 'solid' : 'regular'} fa-heart" style="color:${isFav ? 'red' : '#999'}; cursor:pointer; font-size:1.4rem;" onclick="event.stopPropagation(); toggleFavorite('${id}')"></i>`;
    }

    function showFavorites() {
        const display = document.getElementById('display');
        document.getElementById('home-view').style.display = 'none';
        display.innerHTML = `<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; animation: slideInUp 0.4s ease-out;"><h2 style="color:black; font-family:'Inter', sans-serif;">Your Saved Hadees</h2><button onclick="location.reload()" style="border:none; background:none; color:black; cursor:pointer; font-family:'Inter', sans-serif; transition:0.3s; animation: slideInUp 0.5s ease-out;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"><i class="fa-solid fa-house"></i> Home</button></div><div id="favorites-list" style="display:flex; flex-direction:column; gap:10px;"></div>`;
        const listContainer = document.getElementById('favorites-list');
        const favorites = JSON.parse(localStorage.getItem('hadees_favorites') || '[]');
        if (favorites.length === 0) { listContainer.innerHTML = '<p style="text-align:center; color:#999;">‡§ï‡•ã‡§à ‡§π‡§¶‡•Ä‡§∏ ‡§∏‡•á‡§µ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡•Ä ‡§ó‡§à</p>'; return; }
        favorites.forEach(fid => {
            const h = window.allData[fid]; if (!h) return;
            const titleDiv = document.createElement('div');
            titleDiv.className = 'hadees-title';
            titleDiv.style.cssText = `background: white; padding: 15px; border-radius: 12px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); color: black; font-family: 'Inter', sans-serif; animation: fadeIn 0.4s ease-out; transition: 0.3s ease;`;
            titleDiv.innerHTML = `<div style="flex:1;"><strong style="color: black; font-family:'Inter', sans-serif;">${h.title || 'Hadees ' + h.num}</strong><small style="color:#777; display:block; font-family:'Inter', sans-serif;">${h.book || ''}</small></div><div style="display:flex; gap:12px; align-items:center;">${getFavoriteIcon(fid)}<i class="fa-solid fa-chevron-down" style="color:black; transition:0.3s;"></i></div>`;
            titleDiv.onmouseover = function() { this.style.transform = 'translateY(-2px)'; };
            titleDiv.onmouseout = function() { this.style.transform = 'translateY(0)'; };
            const contentDiv = document.createElement('div');
            contentDiv.style.display = 'none';
            contentDiv.innerHTML = renderHadeesCard(fid, h);
            titleDiv.onclick = () => { contentDiv.style.display = contentDiv.style.display === 'block' ? 'none' : 'block'; };
            listContainer.appendChild(titleDiv); listContainer.appendChild(contentDiv);
        });
    }

    function showAllBooks() {
        const display = document.getElementById('display');
        document.getElementById('home-view').style.display = 'none';
        display.innerHTML = `<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; animation: slideInUp 0.4s ease-out;"><h2 style="color:black; font-family:'Inter', sans-serif;">All Books</h2><button onclick="location.reload()" style="border:none; background:none; color:black; cursor:pointer; font-family:'Inter', sans-serif; transition:0.3s; animation: slideInUp 0.5s ease-out;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"><i class="fa-solid fa-house"></i> Home</button></div><div id="books-list" style="display:flex; flex-direction:column; gap:12px; max-width:800px; margin:0 auto;"></div>`;
        db.ref('v11/structure').once('value', snap => {
            const data = snap.val() || {};
            const listContainer = document.getElementById('books-list');
            let delay = 0;
            Object.keys(data).forEach(book => {
                const bookDiv = document.createElement('div');
                bookDiv.className = 'book-item';
                bookDiv.style.cssText = `background: white; padding: 18px; border-radius: 12px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 3px 10px rgba(0,0,0,0.06); color: black; font-family: 'Inter', sans-serif; animation: fadeIn 0.4s ease-out ${delay}s both; transition: 0.3s ease;`;
                bookDiv.innerHTML = `<div><strong style="font-family:'Inter', sans-serif;">üìñ ${book}</strong></div><i class="fa-solid fa-chevron-right" style="color:var(--accent); transition:0.3s;"></i>`;
                bookDiv.onmouseover = function() { this.style.transform = 'translateY(-3px)'; this.querySelector('i').style.transform = 'translateX(5px)'; };
                bookDiv.onmouseout = function() { this.style.transform = 'translateY(0)'; this.querySelector('i').style.transform = 'translateX(0)'; };
                bookDiv.onclick = () => openBookChapters(book, data[book]);
                listContainer.appendChild(bookDiv);
                delay += 0.05;
            });
        });
    }

    function openBookChapters(book, bookData) {
        currentBookData = bookData;
        const display = document.getElementById('display');
        display.innerHTML = `<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; animation: slideInUp 0.4s ease-out;"><h2 style="color: black; font-family:'Inter', sans-serif;">${book}</h2><button onclick="showAllBooks()" style="border:none; background:none; color:black; cursor:pointer; font-weight:bold; font-family:'Inter', sans-serif; transition:0.3s; animation: slideInUp 0.5s ease-out;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"><i class="fa-solid fa-arrow-left"></i> Back</button></div><div id="chapters-list" style="display:flex; flex-direction:column; gap:10px;"></div>`;
        const listContainer = document.getElementById('chapters-list');
        let delay = 0;
        Object.entries(bookData.chaps || {}).forEach(([cid, cname]) => {
            const chapDiv = document.createElement('div');
            chapDiv.style.cssText = `background: white; padding: 15px; border-radius: 12px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); color: black; font-family: 'Inter', sans-serif; animation: fadeIn 0.4s ease-out ${delay}s both; transition: 0.3s ease;`;
            chapDiv.innerHTML = `<div>‚îú ${cname}</div><i class="fa-solid fa-chevron-right" style="color:var(--accent); transition:0.3s;"></i>`;
            chapDiv.onmouseover = function() { this.style.transform = 'translateY(-2px)'; this.querySelector('i').style.transform = 'translateX(5px)'; };
            chapDiv.onmouseout = function() { this.style.transform = 'translateY(0)'; this.querySelector('i').style.transform = 'translateX(0)'; };
            chapDiv.onclick = () => openChapter(book, cname);
            listContainer.appendChild(chapDiv);
            delay += 0.05;
        });
    }

    function toggleMenu() {
        const side = document.getElementById('sidebar');
        const isActive = side.classList.toggle('active');
        document.getElementById('side-overlay').style.display = isActive ? 'block' : 'none';
    }

    function initApp() {
        renderMenu();
        db.ref('v11/content').on('value', snap => {
            window.allData = snap.val() || {};
            document.getElementById('st-h').innerText = Object.keys(window.allData).length;
            showHOTD(); initFavorites();
        });
    }

    function showHOTD() {
        const keys = Object.keys(window.allData);
        if(keys.length > 0) {
            const h = window.allData[keys[Math.floor(Math.random() * keys.length)]];
            document.getElementById('hotd-content').innerHTML = `<div class="arabic" style="font-size: 1.5rem;">${h.arb}</div><div class="translation" style="font-size: 0.95rem;">${h.trans}</div>`;
        }
    }

    function login() { 
        if(prompt("Admin Pass:") === "9950866474") { 
            isAdmin = true; 
            document.getElementById('admin-panel').style.display = 'block'; 
            document.getElementById('home-admin-section').style.display = 'block'; 
            document.getElementById('loginBtn').style.display = 'none'; 
            renderMenu(); 
        } 
    }
    function escapeJS(str) { return (str || '').replace(/'/g, "\\'").replace(/"/g, '\\"').replace(/\n/g, '\\n'); }

    function renderMenu() {
        db.ref('v11/structure').on('value', snap => {
            const menu = document.getElementById('menu'); menu.innerHTML = "";
            const data = snap.val() || {};
            document.getElementById('st-b').innerText = Object.keys(data).length;
            for(let book in data) {
                let chHtml = "";
                Object.entries(data[book].chaps || {}).forEach(([cid, cname]) => {
                    chHtml += `<div class="chap-item"><div class="chap-btn" onclick="openChapter('${escapeJS(book)}','${escapeJS(cname)}')">‚îú ${cname}</div></div>`;
                });
                menu.innerHTML += `<div class="book-wrap"><div class="book-head" onclick="this.nextElementSibling.style.display=this.nextElementSibling.style.display==='none'?'block':'none'"><span>üìñ ${book}</span></div><div class="chap-panel" style="display:none; padding-left:15px;">${chHtml}</div></div>`;
            }
        });
    }

    // UPDATED Global Search (Ab sirf ek input se search karega)
    function globalSearch() {
        let txt = document.getElementById('gT').value.toLowerCase();
        const display = document.getElementById('display');
        if(!txt) { display.innerHTML=""; document.getElementById('home-view').style.display="block"; return; }
        document.getElementById('home-view').style.display="none";
        display.innerHTML = `<h3 style="color:black; margin-bottom:20px; font-family:'Inter', sans-serif; animation: slideInUp 0.4s ease-out;">Results:</h3><div id="search-list" style="display:flex; flex-direction:column; gap:10px;"></div>`;
        const listContainer = document.getElementById('search-list');
        let delay = 0;
        for(let id in window.allData) {
            let h = window.allData[id];
            // Search in text or check if text matches the Hadees number
            if(h.arb.toLowerCase().includes(txt) || h.trans.toLowerCase().includes(txt) || h.num.toString() === txt) {
                const titleDiv = document.createElement('div');
                titleDiv.className = 'hadees-title';
                titleDiv.style.cssText = `background: white; padding: 15px; border-radius: 12px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); color: black; font-family: 'Inter', sans-serif; animation: fadeIn 0.4s ease-out ${delay}s both; transition: 0.3s ease;`;
                titleDiv.innerHTML = `<div style="flex:1;"><strong style="color:black; font-family:'Inter', sans-serif;">Hadees No. ${h.num}</strong><small style="color:#777; display:block; font-family:'Inter', sans-serif;">${h.book || ''}</small></div><i class="fa-solid fa-chevron-down"></i>`;
                titleDiv.onmouseover = function() { this.style.transform = 'translateY(-2px)'; };
                titleDiv.onmouseout = function() { this.style.transform = 'translateY(0)'; };
                const contentDiv = document.createElement('div');
                contentDiv.style.display = 'none';
                contentDiv.innerHTML = renderHadeesCard(id, h);
                titleDiv.onclick = () => { contentDiv.style.display = contentDiv.style.display === 'block' ? 'none' : 'block'; };
                listContainer.appendChild(titleDiv); listContainer.appendChild(contentDiv);
                delay += 0.03;
            }
        }
    }

    function openChapter(b, c) {
        sB = b; sC = c;
        document.getElementById('home-view').style.display = 'none';
        db.ref('v11/structure/' + b).once('value', snap => { currentBookData = snap.val(); renderHadeesList(c, b); });
    }

    function renderHadeesList(chap, bookName) {
        const display = document.getElementById('display');
        display.innerHTML = `<div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px; animation: slideInUp 0.4s ease-out;"><h2 style="color: black; font-family:'Inter', sans-serif;">${chap}</h2><button onclick="openBookChapters('${escapeJS(bookName)}', currentBookData)" style="border:none; background:none; color:black; cursor:pointer; font-weight:bold; font-family:'Inter', sans-serif; transition:0.3s; animation: slideInUp 0.5s ease-out;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'"><i class="fa-solid fa-arrow-left"></i> Back</button></div><div id="hadees-list" style="display:flex; flex-direction:column; gap:10px;"></div>`;
        const listContainer = document.getElementById('hadees-list');
        let delay = 0;
        for(let id in window.allData) {
            let h = window.allData[id];
            if(h.chap === chap) {
                const titleDiv = document.createElement('div');
                titleDiv.className = 'hadees-title';
                titleDiv.style.cssText = `background: white; padding: 15px; border-radius: 12px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); color: black; font-family: 'Inter', sans-serif; animation: fadeIn 0.4s ease-out ${delay}s both; transition: 0.3s ease;`;
                titleDiv.innerHTML = `<div style="flex:1;"><strong style="color: black; font-family:'Inter', sans-serif;">Hadees No. ${h.num}</strong></div><i class="fa-solid fa-chevron-down"></i>`;
                titleDiv.onmouseover = function() { this.style.transform = 'translateY(-2px)'; };
                titleDiv.onmouseout = function() { this.style.transform = 'translateY(0)'; };
                const contentDiv = document.createElement('div');
                contentDiv.style.display = 'none';
                contentDiv.innerHTML = renderHadeesCard(id, h);
                titleDiv.onclick = () => { contentDiv.style.display = contentDiv.style.display === 'block' ? 'none' : 'block'; };
                listContainer.appendChild(titleDiv); listContainer.appendChild(contentDiv);
                delay += 0.03;
            }
        }
    }

    function renderHadeesCard(id, h) {
        return `<div class="hadees-card">
            <div style="color:var(--accent); font-weight:600; margin-bottom:15px; font-family:'Inter', sans-serif; font-size:0.9rem;">HADEES NO. ${h.num}</div>
            <div class="arabic">${h.arb}</div>
            <div class="translation">${h.trans}</div>
            <div class="card-actions">
                <div class="action-btn" onclick="copyText('${escapeJS(h.arb)}\\n${escapeJS(h.trans)}')"><i class="fa-solid fa-copy"></i> Copy</div>
                <div class="action-btn" onclick="shareWA('${escapeJS(h.arb)}', '${escapeJS(h.trans)}')"><i class="fa-brands fa-whatsapp"></i> Share</div>
            </div>
        </div>`;
    }

    function copyText(t) { navigator.clipboard.writeText(t); alert("Copied!"); }
    function shareWA(a, t) { window.open(`https://wa.me/?text=${encodeURIComponent(a + '\n\n' + t)}`); }
</script>
</body>
</html>
